<?php

/***************************************************************************************
 *                                                                                      *
 * Initialization page displaying all necessary passwords to the user.                  *
 * When the user confirms this page the page replaces itself with the QUIQQER index.php *
 *                                                                                      *
 * Author: Jan Wennrich (PCSG)                                                          *
 *                                                                                      *
 ***************************************************************************************/

session_start();

if (isset($_REQUEST['reset_code'])) {
    session_destroy();
    session_start();
}


if (isset($_SESSION['auth_code']) &&
    $_REQUEST['auth_code'] != $_SESSION['auth_code'] &&
    isset($_GET['confirming'])
) {
    $cmdOutput = "";
    $cmdReturnValue = -1;

    exec("python3 passdora_scripts/init_system.py init", $cmdOutput, $cmdReturnValue);

    echo json_encode(
        array(
            'returnCode' => $cmdReturnValue,
            'output' => $cmdOutput
        )
    );

    // Delete password file
    unlink('./passdora_passwords.ini');

    // Enable QUIQQER index.php
    rename('./index.php', './index.php.init');
    rename('./index.php.quiqqer', './index.php');

    exit;
}

define("PASSWORDS", parse_ini_file('./etc/passdora_passwords.ini.php'));

define("RESTORE_KEY", parse_ini_file('./etc/passdora_restore_key.ini.php')['restore_key']);

define("PASSDORA_LOGO", "data:image/png;base64,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");

?>

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Passdora - Welcome</title>

    <link rel="stylesheet" href="/packages/bin/font-awesome/css/font-awesome.min.css">

    <link href='//fonts.googleapis.com/css?family=Open+Sans:300,400,600,800' rel='stylesheet' type='text/css'>
    <!--    <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>-->

    <style>
        body {
            margin: 0;
            padding: 0;

            font-family: 'Open Sans', sans-serif;
            font-size: 16px;
            color: #444;
            line-height: 1.65em;
            letter-spacing: 1px;
            font-weight: 300;

            background-color: #fdfdfd;
        }

        html, body {
            height: 100%;
            width: 100%;
        }

        #loader-overlay {
            display: flex;
            position: fixed;
            z-index: 999;
            visibility: visible;
            opacity: 1;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(68, 68, 68, 0.56);
            color: #7F272A;
            width: 100%;
            height: 100%;
            font-size: 1.5em;
            text-align: center;
            transition: visibility 0s, opacity 0.5s linear;
        }

        #loader-overlay.hidden {
            visibility: hidden;
            opacity: 0;
        }

        #loader-overlay-text {
            color: #ececec;
            font-weight: bolder;
        }

        header {
            text-align: center;
            background-color: #ececec;
            margin-bottom: 60px;
        }

        #logo {
            width: 750px;
            margin: 40px 40px;
        }

        #welcome {
            text-align: center;
            width: 600px;
            margin: 0 auto 30px auto;
            line-height: 2em;
        }

        #welcome h1 {
            margin-bottom: 30px;
        }

        #passwords {
            width: 550px;
            margin: 0 auto 60px auto;
        }

        .password-section {
            width: 550px;
            height: 175px;
            text-align: center;
            margin: 0 auto 30px auto;
        }

        .password-section#restore {
            height: 100px;
        }

        .password-section input {
            height: 50px;
            width: 300px;
            float: left;
            padding: 0 20px;
            margin: 0;
            border: 2px solid #7F272A;
            border-radius: 0 6px 6px 0;

            font-family: 'Open Sans', sans-serif;
            font-size: 16px;
            color: #444;
            line-height: 1.65em;
            letter-spacing: 1px;
            font-weight: 300;
        }

        .pw-header {
            font-weight: bold;
            font-size: 20px;

            height: 30px;

        }

        .pw-data-row {
            display: flex;
            flex-direction: row;
            justify-content: center;

            margin-bottom: 20px;
        }

        .password-section .pw-data-label {
            width: 50px;
            height: 50px;
            color: white;
            background-color: #7F272A;

            border: 2px solid #7F272A;
            border-radius: 6px 0 0 6px;

            display: flex;
            align-items: center;
            justify-content: center;
        }

        footer {
            background-color: #ececec;
            padding: 30px 0;
        }

        #buttons {
            text-align: center;
        }

        #buttons button {
            width: 400px;
            height: 50px;

            background-color: #7F272A;
            color: white;

            font-family: 'Open Sans', sans-serif;
            font-size: 18px;
            font-weight: 300;

            border-radius: 5px;
            border: none;

            cursor: pointer;
        }

        #buttons button[disabled],
        #buttons button.primary[disabled] {
            background-color: #E0E0E0;
            color: #444444;
            cursor: progress;
        }

        #buttons button.primary {
            color: white;
            background: #65A644;
        }

        #note {
            text-align: center;
            width: 600px;
            margin: 0 auto 65px auto;

            line-height: 1.75em;

            color: #444;
            background-color: #ffecec;

            padding: 30px 20px;

            border-radius: 5px;
            border-left: 25px solid;
            border-right: 25px solid;
            border-color: #7F272A;
        }

        #note-icon {
            margin-bottom: 20px;

            color: #7F272A;
        }

        #print {
            display: none;
        }

        @media print {

            body > * {
                display: none;
            }

            #print {
                display: block;
            }

            body {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
<div id="loader-overlay" class="hidden">
    <i id="loader-overlay-icon" class="fa fa-circle-o-notch fa-spin fa-5x"></i>
    <!--<span class="fa-stack fa-lg fa-3x">
        <i class="fa fa-spinner fa-spin fa-stack-2x"></i>
        <i class="fa fa-check fa-stack-1x fa-inverse"></i>
    </span>-->
    <p id="loader-overlay-text"><b>Loading Passdora...</b></p>
</div>

<header>
    <img id="logo"
         src="<?php echo PASSDORA_LOGO ?>">
</header>

<div id="welcome">
    <h1>Welcome to Passdora!</h1>
</div>

<?php
if (!isset($_REQUEST['auth_code'])) {
    $authCode              = rand(10000, 99999);

    $_SESSION['auth_code'] = $authCode;

    $output = "none";
    $result = "-1";

    exec("python3 passdora_scripts/init_system.py show_code {$authCode}", $output, $result);

    echo "
        <h2>Please enter the code displayed on the Passdora box:</h2>
        <form action='/index.php' method='get'>
            <input type='text' name='auth_code'>
            <input type='submit' value='Submit'>
        </form>    
    ";

    exit;
}

if (isset($_REQUEST['auth_code']) && $_REQUEST['auth_code'] != $_SESSION['auth_code']) {
    echo "
        <h2>Invalid authentication code.</h2>
        <form action='/index.php' method='get'>
            <input type='hidden' name='reset_code' value='1'>
            <input type='submit' value='Reset Code'>
        </form>  
    ";

    exit;
}
?>

<div id="note">
    <i id="note-icon" class="fa fa-exclamation-triangle fa-3x"></i>
    <div id="note-text">
        All passwords to administrate Passdora can be found below.<br>
        <br>
        Log in to Passdora-administration with the "Passdora"-credentials.<br>
        All backups will be encrypted with the "Restore"-key.<br>
        Advanced users may use the "SSH"-credentials for maintenance tasks.<br>
        <br>
        Please <b>print this page</b> and keep it somewhere safe and secure.<br>
        If you lose a password, your <b>data can not be recovered!</b><br>
        After confirming, these <b>passwords can not be displayed again</b>.
    </div>
</div>


<div id="passwords">

    <!-- Passdora -->
    <div class="password-section">
        <div class="pw-header">
            Passdora:
        </div>

        <div class="pw-data">
            <div class="pw-data-row">
                <div class="pw-data-label">
                    <label for="ssh-user" class="fa fa-user fa-lg"></label>
                </div>
                <input type="text" id="ssh-user" value="admin" readonly/>
            </div>

            <div class="pw-data-row">
                <div class="pw-data-label">
                    <label for="ssh-pw" class="fa fa-key fa-lg"></label>
                </div>
                <input type="text" id="ssh-pw" value="<?php echo PASSWORDS['quiqqer_pw'] ?>" readonly/>
            </div>
        </div>
    </div>


    <!-- Restore -->
    <div class="password-section" id="restore">
        <div class="pw-header">
            Restore-Key:
        </div>

        <div class="pw-data">
            <div class="pw-data-row">
                <div class="pw-data-label">
                    <label for="ssh-pw" class="fa fa-key fa-lg"></label>
                </div>
                <input type="text" id="ssh-pw" value="<?php echo RESTORE_KEY ?>" readonly/>
            </div>
        </div>
    </div>

    <!-- SSH -->
    <div class="password-section">
        <div class="pw-header">
            SSH:
        </div>

        <div class="pw-data">
            <div class="pw-data-row">
                <div class="pw-data-label">
                    <label for="ssh-user" class="fa fa-user fa-lg"></label>
                </div>
                <input type="text" id="ssh-user" value="pi" readonly/>
            </div>

            <div class="pw-data-row">
                <div class="pw-data-label">
                    <label for="ssh-pw" class="fa fa-key fa-lg"></label>
                </div>
                <input type="text" id="ssh-pw" value="<?php echo PASSWORDS['ssh_pw'] ?>" readonly/>
            </div>
        </div>
    </div>
</div>

<footer>
    <div id="buttons">
        <p>
            <button id="printButton"><i class="fa fa-print"></i> Print</button>
        </p>
        <p>
            <button id="confirmButton" class="primary" disabled
                    title="Make sure you read the notice above and stored the passwords"><i class="fa fa-check"></i>
                Confirm
            </button>
        </p>
    </div>
</footer>

<!-- Only shown when printing -->
<div id="print">
    <img id="logo"
         src="<?php echo PASSDORA_LOGO ?>"/>
    <p>
        <b>Passdora</b><br>
        Username: admin<br>
        Password: <?php echo PASSWORDS['quiqqer_pw'] ?>
    </p>
    <p>
        <b>Restore</b><br>
        Restore-Key: <?php echo RESTORE_KEY ?>
    </p>
    <p>
        <b>SSH</b><br>
        Username: pi<br>
        Password: <?php echo PASSWORDS['ssh_pw'] ?>
    </p>
</div>

<script type="text/javascript">
    // Print-Button
    document.getElementById('printButton').addEventListener('click', function (event) {
        window.print();
    });
    window.onafterprint = handleAfterPrint;


    // Highlight input content on click
    var inputs = document.getElementsByTagName('input');
    for (var i = 0; i < inputs.length; i++) {
        inputs[i].addEventListener('focus', function (event) {
            event.srcElement.select();
        });
    }


    var ConfirmButton = document.getElementById('confirmButton');

    ConfirmButton.addEventListener('click', function (event) {
        handleConfirmButtonClick();
    });

    var confirmCountdown = 30;
    var ConfirmInterval = setInterval(function () {

        ConfirmButton.innerHTML = '<i class="fa fa-check"></i> Confirm (' + confirmCountdown + ')';

        if (--confirmCountdown < 0) {
            handleCountdownZero();
        }
    }, 1000);


    var showLoaderOverlay = function(message) {
        document.getElementById('loader-overlay-text').innerHTML = message;
        document.getElementById('loader-overlay').className = '';
    };

    var hideLoaderOverlay = function(message) {
        document.getElementById('loader-overlay').className = 'hidden';
    };

    var loaderOverlayShowIcon = function (icon) {
        var OverlayIcon = document.getElementById('loader-overlay-icon');
        OverlayIcon.className = "fa fa-5x " + icon;
    };

    var loaderOverlayShowSuccess = function() {
        loaderOverlayShowIcon("fa-check");
    };

    var loaderOverlayShowError = function() {
        loaderOverlayShowIcon("fa-close");
    };

    var loaderOverlayResetIcon = function(instantly) {
        var timeout = instantly ? 0 : 2000;
        window.setTimeout(function () {
            document.getElementById('loader-overlay-icon').className = "fa fa-circle-o-notch fa-spin fa-5x"
        }, timeout)
    };

    var confirmPasswordsCopied = function() {
        return confirm('Did you really save all passwords?\nThe passwords can not be displayed again.\nIf you lose them your data can not be recovered!')
    };

    var confirmButtonPressMessage = function() {
        return confirm('Make sure you can physically access your Passdora box.\nAfter confirming this dialog you have 30 seconds to confirm the initialization by pressing and holding the button on your box for 3 seconds.')
    };

    var handleAuthSuccessful = function() {
        loaderOverlayShowSuccess();
        showLoaderOverlay('Authentication successful!');

        window.setTimeout(function() {
            loaderOverlayResetIcon(true);
            showLoaderOverlay('Loading Passdora...');
            window.setTimeout(function () {
                location.reload(true);
            }, 3000)
        }, 2000);
    };

    var handleAuthError = function(message) {
        showLoaderOverlay(message);
        loaderOverlayShowError();
        window.setTimeout(function () {
            alert(message);
            hideLoaderOverlay();
            loaderOverlayResetIcon(true);
        }, 50)
    };

    var handleAfterPrint = function(event) {
        enableConfirmButton();
    };

    var handleCountdownZero = function() {
        enableConfirmButton();
        clearInterval(ConfirmInterval);
    };

    var enableConfirmButton = function() {
        ConfirmButton.innerHTML = '<i class="fa fa-check"></i> Confirm';
        ConfirmButton.disabled = false;
    };

    var handleConfirmButtonClick = function() {
        if (confirmPasswordsCopied() && confirmButtonPressMessage()) {
            var XHttp = new XMLHttpRequest();

            XHttp.onreadystatechange = function () {
                if (this.readyState === 4) {
                    if (this.status === 200) {
                        var Response = JSON.parse(XHttp.response);
                        switch(Response.returnCode) {
                            case 0:
                                handleAuthSuccessful();
                                break;
                            case 3:
                                handleAuthError('The button was not pressed long enough.\nPlease try again.');
                                break;
                            case 4:
                                handleAuthError('The button was not pressed.\nPlease try again.');
                                break;
                            default:
                                handleAuthError('Something went wrong.\nPlease try again.');
                                break;
                        }
                    } else {
                        console.error('request failed');
                        handleAuthError('Something went wrong. Please try again later.');
                    }
                }
            };

            showLoaderOverlay('Awaiting button press for authentication...');
            XHttp.open("POST", "/index.php?confirming=1", true);
            XHttp.send("confirmed=1");
        }
    }
</script>
</body>
</html>
